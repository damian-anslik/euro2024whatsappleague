{% extends 'base.html' %}

{% block content %}
<div class="league-container">
    <h2>Change username</h2>
    <div class="success-container"></div>
    <div class="error-container"></div>
    <form id="change-username-form">
        <!-- Style the form so that field name is above the field -->
        <div class="form-group">
            <label for="username" style="display: block; margin-bottom: 5px;">Username</label>
            <input type="text" class="form-control" id="username" name="username" value="{{ username }}"
                style="width: 100%; padding: 8px; box-sizing: border-box;" required>
        </div>
        <button type="submit" class="btn btn-primary"
            style="margin-top: 10px; color: #fff; background-color: #0e1e5b; padding: 0.5rem;">Change username</button>
    </form>
</div>
<script>
    let successMessage = document.querySelector('.success-container');
    let errorMessage = document.querySelector('.error-container');
    let submitButton = document.querySelector('button[type="submit"]');
    document.querySelector('#change-username-form').addEventListener('submit', async function (event) {
        errorMessage.style.display = 'none';
        submitButton.disabled = true;
        submitButton.textContent = 'Updating...';
        event.preventDefault();
        const username = document.querySelector('input[name="username"]').value;
        const form = new FormData();
        form.append('username', username);
        let response = await fetch('/update-username', {
            method: 'POST',
            body: form,
            redirect: 'follow'
        })
        // If the response is OK, show success message
        // Else show error message
        if (response.ok) {
            successMessage.textContent = 'Username updated successfully';
            successMessage.style.display = 'block';
            successMessage.style.marginBottom = '10px';
            errorMessage.style.display = 'none';
        } else {
            // Error message is in JSON detail field
            responseJSON = await response.json();
            errorMessage.textContent = responseJSON.detail || 'Error updating username';
            errorMessage.style.display = 'block';
            errorMessage.style.marginBottom = '10px';
            successMessage.style.display = 'none';
        }
        submitButton.disabled = false;
        submitButton.textContent = 'Change username';
    });
</script>
{% endblock %}